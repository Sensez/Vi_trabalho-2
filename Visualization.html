<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
        .bar {
          fill: steelblue;
        }

        .axis text {
          font: 10px sans-serif;
        }

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .x.axis path {
          display: none;
        }
    </style>
    <script src="d3/d3.js"></script>
  </head>
  <body>
    <script>

      var dates = [];
      var years = [];
      var dayligthSightings = [];
      var afternoonSightings = [];
      var nightSightings = [];
      var newDataSet = [];

      d3.csv("complete.csv", function(error, data) {
        if (error) throw error;

        data.forEach(function(d) {
          dates.push(d.datetime);
        });

        dates.forEach(function(entry) {
          var time = parseInt(entry.split("/")[2].split(" ")[1].split(":"));
          var year = entry.split("/")[2].split(" ")[0];

          if(years.indexOf(year) == -1)
            years.push(year);

          if(time >= 6 && time < 12){
            if(dayligthSightings[year] != null)
              dayligthSightings[year] += 1;
            else
                dayligthSightings[year] = 1;
          }
          else if(time >= 12 && time < 18){
            if(afternoonSightings[year] != null)
              afternoonSightings[year] += 1;
            else
                afternoonSightings[year] = 1;
          }
          else{
            if(nightSightings[year] != null)
              nightSightings[year] += 1;
            else
              nightSightings[year] = 1;
          }
        });

        years.sort().forEach(function(year) {
            var obj = new Object;
            obj["year"] = year;
            obj["dia"] = dayligthSightings[year];
            obj["tarde"] = afternoonSightings[year];
            obj["noite"] = nightSightings[year];
            newDataSet.push(obj);
        });

        var margin = {top: 20, right: 30, bottom: 30, left: 40},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;
            margin = 20;

        var maxSightings = 0;

        newDataSet.forEach(function(data){
          if(data.dia + data.tarde + data.noite > maxSightings)
            maxSightings = data.dia + data.tarde + data.noite ;
        });

        var y_extent = [0,maxSightings];
        var y_scale = d3.scaleLinear().range([height - margin, margin]).domain(y_extent);
        var x_extent = [newDataSet[0].year, newDataSet[newDataSet.length-1].year];
        var x_scale = d3.scaleLinear().range([margin, width - margin]).domain(x_extent);
        var x_axis = d3.axisBottom(x_scale);
        var y_axis = d3.axisLeft(y_scale);

    });
    </script>
  </body>
</html>
